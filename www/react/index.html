<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="mobile-web-app-capable" content="yes" />
    <link rel="shortcut icon" href="../favicon.ico" type="image/x-icon" />
    <link href='https://fonts.googleapis.com/css?family=Roboto:400,300italic,300,400italic,500,700,700italic,500italic' rel='stylesheet' type='text/css'>
    <title>Onsen UI 2.0 Quickstart</title>

    <link rel="stylesheet" href="../lib/onsenui/css/onsenui.css" type="text/css" media="all" />
    <link rel="stylesheet" href="../lib/onsenui/css/onsen-css-components.css" type="text/css" media="all" />
    <link rel="stylesheet" href="app.css" type="text/css" media="all" />

    <script src="../lib/onsenui/js/onsenui.js"></script>
    <script src="../lib/react/react.js"></script>
    <script src="../lib/react/react-dom.js"></script>
    <script src="../lib/jquery/dist/jquery.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.23/browser.min.js"></script>

    <style>
      .todo-checkbox {
        display: inline !important;
        margin-right: 30px;
      }
    </style>

    <script type="text/babel">
      var TodoItem = React.createClass({
        getInitialState: function() {
          return {
            edit: false
          };
        },
        toggleEdit: function() {
          this.setState({edit: !this.state.edit});
        },
        onTitleChange: function(event) {
          this.props.onTitleChange(event.target.value);
        },
        componentDidMount: function() {
          $(ReactDOM.findDOMNode(this)).on('change', 'ons-material-input', this.onTitleChange);
        },
        componentWillUnmount: function() {
          $(ReactDOM.findDOMNode(this)).off('change', 'ons-material-input', this.onTitleChange);
        },
        componentDidUpdate: function() {
          // Focus the input.
          if (this.state.edit) {
            this.refs.titleInput.querySelector('input').focus();
          }
        },
        render: function() {
          return (
            <ons-list-item modifier="material">
              <label className="checkbox checkbox--material todo-checkbox">
                <input type="checkbox" checked={this.props.done} onChange={this.props.onToggle} className="checkbox__input checkbox--material__input" />
                <div className="checkbox__checkmark checkbox--material__checkmark"></div>
              </label>
              { this.state.edit ?
                <ons-material-input ref="titleInput" onChange={this.onTitleChange} onBlur={this.toggleEdit} label="Title"></ons-material-input> :
                <span onClick={this.toggleEdit}>{this.props.title}</span>
              }
            </ons-list-item>
          );
        }
      });

      var TodoApp = React.createClass({
        getInitialState: function() {
          return {
            todos: [
              {
                title: 'Water the plants',
                done: false,
              },
              {
                title: 'Walk the dog',
                done: true,
              },
              {
                title: 'Go to the dentist',
                done: false,
              },
              {
                title: 'Buy milk',
                done: false,
              },
              {
                title: 'Play tennis',
                done: true,
              }
            ]
          };
        },
        toggleItem: function(i) {
          var todos = this.state.todos;
          todos[i].done = !todos[i].done;
          this.setState({todos: todos});
        },
        titleChange: function(i, title) {
          var todos = this.state.todos;
          todos[i].title = title;
          this.setState({todos: todos});
        },
        render: function() {
          return (
            <ons-list modifier="material">
              <ons-list-header modifier="material">Things to do</ons-list-header>
              {this.state.todos.map(function(todo, i) {
                  return <TodoItem
                    key={i}
                    onToggle={this.toggleItem.bind(this, i)}
                    onTitleChange={this.titleChange.bind(this, i)}
                    done={todo.done}
                    title={todo.title}>
                  </TodoItem>
              }.bind(this))}
            </ons-list>
          );
        }
      });

      ReactDOM.render(<TodoApp />, document.getElementById('app'));
    </script>
</head>

<body>
  <ons-page>
    <ons-toolbar modifier="material">
      <div class="center">
        Todos
      </div>
    </ons-toolbar>

    <div id="app"></div>
  </ons-page>
</body>
</html>
